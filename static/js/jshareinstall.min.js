ShareInstall=function(win,doc,xhr){function ReadyObj(){this.arr=[],this.run=function(e){this.arr?this.arr[this.arr.length]=e:e()},this.isReady=function(){return null==this.arr},this.ready=function(){if(null!=this.arr)for(var e=0;e<this.arr.length;e++)this.arr[e]();this.arr=null}}function myAjax(e){var n=new xhr,t=e.data,a=e.url,r=e.method;t&&"string"!=typeof t&&(t=MyJSON.stringify(t)),"POST"!=r&&t&&(a=a+(a.indexOf("?")>-1?"&":"?")+t,t=null),n.onreadystatechange=function(){if(n.readyState==("number"==typeof xhr.DONE?xhr.DONE:4)){if(200==n.status){var t=n.response||n.responseText||{};e.success&&e.success("string"==typeof t?MyJSON.parse(t):t)}else e.error&&e.error(n,n.statusText);e.complete&&e.complete(n)}},n.open(r,a,!0),n.ontimeout=function(){e.error&&e.error(n,n.statusText)},n.timeout=e.timeout||0,n.setRequestHeader&&n.setRequestHeader("Content-Type","application/json;charset=utf-8"),n.withCredentials=(e.xhrFields||{}).withCredentials,n.send(t)}function httpAjax(e){e=e||{};var n=e.type||"GET";n=n.toUpperCase()||"GET";var t=e.url||"",a=e.async,r=e.data||null,i=e.success||function(){},o=e.fail||function(){},l=null;l=XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");var c=[];for(var s in r)c.push(s+"="+r[s]);var d=c.join("&");"POST"===n?(l.open(n,t,a),l.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),l.send(d)):(l.open(n,t+"?"+d,a),l.send(null)),l.onreadystatechange=function(){if(4==l.readyState){var e=l.status;e>=200&&e<300?i&&i(l.responseText):o&&o(e)}}}function getContext(){var e=doc.createElement("canvas");if(e&&"function"==typeof e.getContext)for(var n=["webgl","webgl2","experimental-webgl2","experimental-webgl"],t=0;t<n.length;t++){var a=n[t],r=e.getContext(a);if(r){var i={};i.context=a,i.version=r.getParameter(r.VERSION),i.vendor=r.getParameter(r.VENDOR),i.sl_version=r.getParameter(r.SHADING_LANGUAGE_VERSION),i.max_texture_size=r.getParameter(r.MAX_TEXTURE_SIZE);var o=r.getExtension("WEBGL_debug_renderer_info");return o&&(i.vendor=r.getParameter(o.UNMASKED_VENDOR_WEBGL),i.renderer=r.getParameter(o.UNMASKED_RENDERER_WEBGL)),i}}return{}}function MyShareInstall(e,n){function t(e,n){var t=!1,a=navigator.userAgent.toLowerCase();a.indexOf("qq")>0&&a.indexOf("micromessenger")<0&&a.indexOf("android")>-1&&(t=!0);var r,i;t?(r="hidden",i="qbrowserVisibilityChange"):void 0!==doc.hidden?(r="hidden",i="visibilitychange"):void 0!==doc.msHidden?(r="msHidden",i="msvisibilitychange"):void 0!==doc.webkitHidden&&(r="webkitHidden",i="webkitvisibilitychange");var o=function(e){return t&&e&&void 0!==e.hidden?e.hidden:doc[r]},l=setTimeout(function(){null==l||o()||(e(),l=null)},n);i&&doc.addEventListener(i,function(e){null!=l&&o(e)&&(clearTimeout(l),l=null)},!1)}function a(e,n,a,r){var i=navigator.userAgent.toLowerCase();i.indexOf("iphone")>-1||i.indexOf("ipad")>-1||i.indexOf("ipod")>-1?f.schemaUrl.indexOf("https://")>-1?C[e](n):(t(function(){var n="//api.shareinstall.com.cn/plists/page?app_key="+x;f.applied&&(n=f.applied),C[e](n)},r),C[e](n)):("function"==typeof a&&t(a,r),C[e](n))}function r(e){var n=doc.createElement("div");return n.innerHTML=e,n=n.children[0],n.onclick=function(){doc.body.removeChild(n)},n}function i(e){var n,t="",a=navigator.userAgent.toLowerCase();try{t=e.match(/\,([^\"]*)\"/)[1]||""}catch(e){}return n=MyJSON.parse(decode2(t)),n.shareInstallCode={appkey:x,timestamp:(+new Date).toString().slice(0,10)},a.indexOf("android")>0?e='<a value="'+encode2(MyJSON.stringify(n))+'">&nbsp;</a>':e.replace(t,encode2(MyJSON.stringify(n)))}function o(e,n,t){e=i(e);if("function"!=typeof doc.execCommand)return!1;var a=doc.createElement("div");a.innerHTML=e;for(var r=[],o=0;o<a.children.length;o++)r[o]=a.children[o];for(var l,c,s=!1,d=n?n+((new Date).getTime()+1e3*(t||1))+"-":null,o=0;o<r.length;o++)try{if(l=r[o],doc.body.appendChild(l),"SELECT"===l.nodeName)l.focus();else if("INPUT"===l.nodeName||"TEXTAREA"===l.nodeName){d&&(l.value=encode2(decode2(l.value)+d));var u=l.hasAttribute("readonly");u||l.setAttribute("readonly",""),l.select(),l.setSelectionRange(0,l.value.length),u||l.removeAttribute("readonly")}else{l.hasAttribute("contenteditable")&&l.focus(),d&&l.setAttribute("class",d),c=win.getSelection();var f=doc.createRange();f.selectNode(l),c.removeAllRanges(),c.addRange(f)}s=doc.execCommand("copy"),doc.body.removeChild(l)}catch(e){doc.body.removeChild(l),s=!1}return c&&c.removeAllRanges(),s}function l(){var n=navigator.userAgent.toLowerCase();f.apkUrl&&"function"==typeof e.apkDownloadHandler?e.apkDownloadHandler(f.apkUrl):(f.fallbackUrl&&p||n.indexOf("android")>-1)&&((n.indexOf("micromessenger")>0||n.indexOf("qq")>0)&&n.indexOf("android")>-1?(f.fallbackUrl&&n.indexOf("micromessenger")<0?C[f.schemaMethod](f.fallbackUrl):n.indexOf("micromessenger")>0&&doc.body.appendChild(p),n.indexOf("qq")>0&&n.indexOf("micromessenger")<0&&!f.fallbackUrl&&MyShareInstall.getAPK()):n.indexOf("android")>-1&&!f.fallbackUrl?MyShareInstall.getAPK():(f.fallbackMethod="hrf",C[f.fallbackMethod](f.fallbackUrl)))}function c(e,n,t){docReady(function(){S.run(function(){var r=navigator.userAgent.toLowerCase(),i=r.indexOf("iphone")>-1?"ios":r.indexOf("android")>-1?"android":"",o=n?l:null,c="";if(e||"android"==f.platform&&"qq"!=f.brower&&"chrome25"!=f.brower&&"samsung"==f.brower&&(e=!0),f.schemaUrl&&e){"ios"===i&&f.schemaUrl.indexOf("https://")>-1&&(f.fallbackUrl.indexOf("https://itunes.apple.com")<0&&(f.applied||(f.fallbackUrl="//api.shareinstall.com.cn/plists/page?app_key="+x)),c="?url="+f.fallbackUrl,f.schemaUrl.indexOf(c)<0&&(f.schemaUrl=f.schemaUrl+c));var s=(t||{}).timeout||f.wt||2e3;(r.indexOf("iphone")>-1||r.indexOf("ipad")>-1||r.indexOf("ipod")>-1)&&r.indexOf("micromessenger")>0&&(doc.body.appendChild(p),f.schemaMethod="frm"),(r.indexOf("iphone")>-1||r.indexOf("ipad")>-1||r.indexOf("ipod")>-1)&&(o=null),a(f.schemaMethod,f.schemaUrl,o,s)}else o&&o()})})}function s(){var e=localStorage.getItem("visitUUID");""!=e&&void 0!=e&&null!=e||(e=MyShareInstall.generateUUID());var n=MyShareInstall.parseUrlParams().channel;n||(n=null);var t=MyShareInstall.judgeSystem(),a="?jsonpcallback=getVisit&uid="+e+"&appkey="+x+"&os="+t+"&channel="+n+"&url="+window.location.href+"&bid=downloadButton",r=document.createElement("script");r.type="text/javascript",r.src="//statlog.shareinstall.com.cn/shareinstall_log/wapclick"+a,document.body.appendChild(r)}function d(n,t){navigator.userAgent.toLowerCase();I&&(clearTimeout(I),I=null),n=n||{},n.v||(n.v=VERSION);var a=encode1(MyJSON.stringify(n)),i=MyJSON.parse(MyJSON.stringify(n));i.cus=t,window._SHAREINSTALLCODE=encode1(MyJSON.stringify(i));var o="";for(var l in n)o+=l+":"+n[l];httpAjax({url:"//check.shareinstall.com.cn/wwwroot",type:"POST",data:{ctype:1,appkey:x},async:!0,success:function(i){console.log("返回的数据");var o=JSON.parse(i);console.log(o),MyShareInstall.domainData=o,myAjax({url:MyShareInstall.domainData.Url1+"?code="+a,method:"POST",xhrFields:{withCredentials:!0},data:t,success:function(a){1==a.status?(f={},f.fallbackUrl="https://www.shareinstall.com/error.html",f.schemaUrl="https://www.shareinstall.com/error.html",f.fallbackMethod="frm",f.schemaMethod="loc"):f=u(a.data[0]||{}),f.applied&&(f.fallbackUrl=f.applied),a.shadow=e.shadow||a.shadow||"<div id='ShareInstallDom' style='font-size:30px;color:#fff;text-align:right;position:fixed;left:0;top:0;background:rgba(0,0,0,0.5);filter:alpha(opacity=50);width:100%;height:100%;z-index:10000;'><img src='//imgmini.eastday.com/shareinstall/admin/assets/1530617476_tip-icon.png' alt='' style='width:60%;margin-top:20px;'></div>",a.shadow&&(p=r(a.shadow)),S.ready(),f.ttl&&(I=setTimeout(function(){d(n,t)},1e3*f.ttl))}})},fail:function(){}})}function u(e){var n={sm:"schemaMethod",st:"schemaTimeout",fm:"fallbackMethod",au:"apkUrl",acl:"allowClickLog",p:"pb"};for(var t in e){var a=n[t];a&&(e[a]=e[t],delete e[t])}return e}e=e||{};var f,p,h,m,g,y,v=e.channelCode,x=e.appKey||"",w=e.onready,S=new ReadyObj,b=this;if(!v){var O=/[\?\&]channelCode=([^=&]+)/.exec(win.location.href);O&&(v=O[1])}"function"==typeof w&&S.run(function(){w.call(b)});try{h=win.screen.width||"",m=win.screen.height||"",y=win.devicePixelRatio===parseInt(win.devicePixelRatio)?parseFloat(win.devicePixelRatio).toFixed(1)||"":parseFloat(win.devicePixelRatio).toString()||"",g=getContext()}catch(e){}var I,C={frm:function(e){var n=doc.createElement("iframe");n.style.display="none",n.style.visibility="hidden",n.src=e,doc.body.appendChild(n)},loc:function(e){win.location=e},hrf:function(e){var n=doc.createElement("a");n.style.display="none",n.href=e,doc.body.appendChild(n),n.click()},inhrf:function(e){var n=doc.createElement("script");n.setAttribute("type","text/javascript"),n.innerHTML='(function(){var a = document.createElement("a");a.style.display = "none";a.href = "'+e.replace(/"/g,'\\"')+'";document.body.appendChild(a);a.click();})()',doc.body.appendChild(n)},open:function(e){win.open(e)}};this.wakeupOrInstall=function(e){MyShareInstall.logAjax(c,e),s(),console.log(f),f.pb&&o(f.pb,f.ypp,parseInt(f.yps||"0"))},this.schemeWakeup=function(e){c(!0,!1,e)},this.install=function(e){c(!1,!0,e),f.pb&&o(f.pb,f.ypp,parseInt(f.yps||"0"))},e.buttonId&&docReady(function(){for(var n=e.buttonId.split(" "),t=0;t<n.length;t++){var a=doc.getElementById(n[t]);a&&a.addEventListener("click",function(){b.wakeupOrInstall()})}}),init(function(t){function a(){var e=(new Date).getTime();window.performance&&"function"==typeof window.performance.now&&(e+=performance.now());var n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==n?t:3&t|8).toString(16)});return localStorage.setItem("visitUUID",n),n}var t=t||[],r=(t.length,navigator.userAgent.toLowerCase()),i=r.indexOf("iphone")>-1||r.indexOf("ipad")>-1||r.indexOf("ipod")>-1?"ios":r.indexOf("android")>-1?"android":"";if("ios"===i)var o=r.match(/os (.*?) like mac os/)[1].replace(/_/g,".");else if("android"===i)var o=r.match(/android\s([0-9\.]*)/)[1];else var o="";window.logData="sw="+(h||0)+"&sh="+(m||0)+"&sp="+y+"&gv="+(g.version||"")+"&gr="+(g.renderer||"")+"&li="+(t.length?t.join("-"):"")+"&os="+i+"&osver="+o+"&appkey="+x+"&v="+VERSION+"&cpp=jssdk&cp="+JSON.stringify(n),d({channelCode:v||"",sw:h.toString()||"0",sh:m.toString()||"0",sp:y,gv:g.version?g.version.replace(/\s/g,""):"",gr:g.renderer?g.renderer.replace(/\s/g,""):"",li:t.length?t.join("-"):"",c:1,apk:e.apkFileName||"",pw:e.preferWakeup?1:0,os:i,osver:o,appkey:x},n),function(){var e=localStorage.getItem("visitUUID");""!=e&&void 0!=e&&null!=e||(e=a());var n=MyShareInstall.parseUrlParams().channel;n||(n=null);var t=ShareInstall.judgeSystem(),r="?jsonpcallback=getVisit&uid="+e+"&appkey="+x+"&os="+t+"&channel="+n+"&url="+window.location.href,i=document.createElement("script");i.type="text/javascript",i.src="//statlog.shareinstall.com.cn/shareinstall_log/wapopen"+r,document.body.appendChild(i)}(),this.getVisit=function(e){e.status}})}var VERSION="1.0.8",b64=function(){function e(e){var n,t,a,i,o=-1,l=e.length,c=[0,0,0,0];for(n=[];++o<l;)t=e[o],a=e[++o],c[0]=t>>2,c[1]=(3&t)<<4|(a||0)>>4,o>=l?c[2]=c[3]=64:(i=e[++o],c[2]=(15&a)<<2|(i||0)>>6,c[3]=o>=l?64:63&i),n.push(r.charAt(c[0]),r.charAt(c[1]),r.charAt(c[2]),r.charAt(c[3]));return n.join("")}function n(e){for(var n,t,a,i,o,l,c,s=[],d=0;d<e.length;)i=r.indexOf(e.charAt(d++)),o=r.indexOf(e.charAt(d++)),l=r.indexOf(e.charAt(d++)),c=r.indexOf(e.charAt(d++)),n=i<<2|o>>4,t=(15&o)<<4|l>>2,a=(3&l)<<6|c,s.push(n),64!=l&&s.push(t),64!=c&&s.push(a);return s}function t(e){var n,t=-1,a=e.length,r=[];if(/^[\x00-\x7f]*$/.test(e))for(;++t<a;)r.push(e.charCodeAt(t));else for(;++t<a;)n=e.charCodeAt(t),128>n?r.push(n):2048>n?r.push(63&n|128):r.push(n>>12|224,n>>6&63|128,63&n|128);return r}function a(e){for(var n=0,t=0,a=0,r=[],i=0;i<e.length;)n=e[i],n<128?(r.push(String.fromCharCode(n)),i++):n>191&&n<224?(t=e[i+1],r.push(String.fromCharCode((31&n)<<6|63&t)),i+=2):(t=e[i+1],a=e[i+2],r.push(String.fromCharCode((15&n)<<12|(63&t)<<6|63&a)),i+=3);return r.join("")}var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=";return[function(n){if(!n)return"";for(var a=t(n),r=a.length,i=0;r>i;i++)a[i]=150^a[i];return e(a)},function(e){if(!e)return"";for(var t=n(e),r=0,i=t.length;i>r;r++)t[r]=150^t[r];return a(t)},function(n){return n?e(t(n)):""},function(e){return e?a(n(e)):""}]}(),encode1=b64[0],decode1=b64[1],encode2=b64[2],decode2=b64[3],docReady=function(){function e(){if(!a){a=!0;for(var e=0;e<t.length;e++)t[e].fn.call(win,t[e].ctx);t=[]}}function n(){"complete"===doc.readyState&&e()}var t=[],a=!1,r=!1;return function(i,o){a?i(o):(t.push({fn:i,ctx:o}),"complete"===doc.readyState||!doc.attachEvent&&"interactive"===doc.readyState?e():r||(doc.addEventListener?(doc.addEventListener("DOMContentLoaded",e,!1),win.addEventListener("load",e,!1)):(doc.attachEvent("onreadystatechange",n),win.attachEvent("onload",e)),r=!0))}}(),init=function(){function e(){s.isReady()||(s.ready(),clearInterval(d),i&&i.close())}function n(){e()}function t(e){for(var n=e.split("."),t=0,a=0;a<n.length;a++)t=t<<8|255&parseInt(n[a]);return t}function a(n){for(var a,r,i,o,s=n.split("\r\n"),d=0;d<s.length;d++){if(a=s[d],r=a.split(" "),0==a.indexOf("a=candidate:")&&(i=r[7])&&"host"==i)o=r[4];else if(0==a.indexOf("a=rtcp:")&&(i=r[2])&&"IP4"==i)o=r[3];else if(0!=a.indexOf("c=")||!(i=r[1])||"IP4"!=i||!(o=r[2]))continue;o&&!l[o]&&/[0-9]{1,3}(\.[0-9]{1,3}){3}/.test(o)&&"0.0.0.0"!=o&&0!=o.indexOf("127.")&&3758096384!=(4026531840&t(o))&&(l[o]=1,c.push(o))}c.length&&e()}var r,i,o,l={},c=[],s=new ReadyObj,d=setInterval(function(){i&&i.localDescription&&i.localDescription.sdp&&o!=i.localDescription.sdp&&(o=i.localDescription.sdp,a(o))},10);try{r=win.RTCPeerConnection||win.mozRTCPeerConnection||win.webkitRTCPeerConnection,r?(i=new r({iceServers:[]},{optional:[{RtpDataChannels:!0}]}),i.onicecandidate=function(e){e.candidate&&e.candidate.candidate&&a("a="+e.candidate.candidate)},i.createDataChannel("shareinstall"),i.createOffer(function(e){try{i.setLocalDescription(e,function(){},n)}catch(e){n()}},n),setTimeout(e,2e3)):n()}catch(e){n()}return function(e){s.run(function(){e(c)})}}(),MyJSON=win.JSON||{parse:function(str){return eval("("+str+")")},stringify:function(){var e=Object.prototype.toString,n=Array.isArray||function(n){return"[object Array]"===e.call(n)},t={'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t"},a=function(e){return t[e]||"\\u"+(e.charCodeAt(0)+65536).toString(16).substr(1)},r=/[\\"\u0000-\u001F\u2028\u2029]/g;return function t(i){if(null==i)return"null";if("number"==typeof i)return isFinite(i)?i.toString():"null";if("boolean"==typeof i)return i.toString();if("object"==typeof i){if("function"==typeof i.toJSON)return t(i.toJSON());if(n(i)){for(var o="[",l=0;l<i.length;l++)o+=(l?", ":"")+t(i[l]);return o+"]"}if("[object Object]"===e.call(i)){var c=[];for(var s in i)i.hasOwnProperty(s)&&c.push(t(s)+": "+t(i[s]));return"{"+c.sort().join(", ")+"}"}}return'"'+i.toString().replace(r,a)+'"'}}()};return MyShareInstall.channelRedirect=function(e,n){new MyShareInstall({appKey:e,channelCode:n,_channelRedirect:!0}).wakeupOrInstall()},MyShareInstall.parseUrlParams=function(){for(var e=(win.location.search||"?").substring(1).replace(/\+/g,"%20"),n=e.split("&"),t={},a=0;a<n.length;a++){var r=n[a].split("="),i=decodeURIComponent(r[0]||""),o=decodeURIComponent(r[1]||"");i&&o&&(void 0===t[i]?t[i]=o:"object"==typeof t[i]?t[i].push(o):t[i]=[t[i],o])}return t},MyShareInstall.setUid=function(){return+new Date+Math.random().toString(10).substring(2,6)},MyShareInstall.setCookie=function(e,n){var t=new Date;t.setTime(t.getTime()+2592e6),document.cookie=e+"="+encodeURI(n)+";expires="+t.toUTCString()+";path=/"},MyShareInstall.getCookie=function(e){var n,t=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(n=document.cookie.match(t))?decodeURI(n[2]):null},MyShareInstall.generateUUID=function(){var e=(new Date).getTime();window.performance&&"function"==typeof window.performance.now&&(e+=performance.now());var n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==n?t:3&t|8).toString(16)});return localStorage.setItem("visitUUID",n),n},MyShareInstall.judgeSystem=function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("iphone")>-1||e.indexOf("ipad")>-1||e.indexOf("ipod")>-1?"ios":"android"},MyShareInstall.url2json=function(e){for(var n,t=e.substring(e.indexOf("?")+1,e.length).split("&"),a={},r=0;n=t[r];r++){var i=n.substring(0,n.indexOf("=")).toLowerCase(),o=n.substring(n.indexOf("=")+1,n.length);o.indexOf("#")>-1&&(o=o.split("#")[0]),a[i]=o}return a},MyShareInstall.logAjax=function(e,n){var t="";MyShareInstall.getCookie("ShareInstallUid")?t=MyShareInstall.getCookie("ShareInstallUid"):(t=MyShareInstall.setUid(),MyShareInstall.setCookie("ShareInstallUid",t));var a="//statlog.shareinstall.com.cn/shareinstall_log/si?ordernumber="+t+"&"+window.logData;httpAjax({url:"//statlog.shareinstall.com.cn/shareinstall_log/si",type:"POST",data:MyShareInstall.url2json(a),async:!1,success:function(){},fail:function(){}}),setTimeout(function(){e(!0,!0,n)})},MyShareInstall.getAPK=function(){var e=document.createElement("script"),n=document.createElement("script"),t=MyShareInstall.domainData.Url2+"?jsonpcallback=getShareApk&code="+window._SHAREINSTALLCODE;e.type="text/javascript",e.src=t,n.type="text/javascript",n.innerHTML='function getShareApk(info) {var iframe = document.createElement("iframe");iframe.style.display = "none";iframe.style.visibility = "hidden"; iframe.src = info.data[0]["fallbackUrl"]; document.body.appendChild(iframe);}',document.body.appendChild(n),document.body.appendChild(e)},MyShareInstall.domainPath="我是初始化数据...",MyShareInstall.docReady=docReady,MyShareInstall}(window,document,XMLHttpRequest);